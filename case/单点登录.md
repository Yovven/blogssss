单点登录SSO(Single Sign On)

一、背景
1.http是无状态的
2.当下多个系统共用一套用户体系，每个系统重复登录冗余/用户体验不好。

二、单点登录的实现效果
用户只需在一个系统登录，打开其他同体系系统时也同样拥有登录状态。

三、核心
添加一个SSO统一认证中心，在这个sso系统中统一管理登录状态。
sso系统与各app系统之间通过授权码交互。sso判断当前用户已登录且app是认证客户端才会授予授权码。
用户打开一个app时，app向sso请求授权码，此时sso判断当前用户是否已登录（通过sso域的cookie判断）。
如果未登录，则跳转至登录页面，用户登录完成之后生成授权码返回给app，app后台会向sso后台做一次授权码验证并获取系统登录态需要的token令牌，在app后台中创建一个session会话，从而取得登录状态。
如果已登录，返回授权码给app，app后台会向sso后台做一次授权码验证并获取系统登录态需要的token，在app后台中创建一个session会话，从而取得登录状态。
第一次登录之后，在sso的cookie有效期内，打开认证中心内的app都只需要做已登录的流程，不需要再重复登录。

四、细节要点
1.重定向
重定向使用302（不缓存，临时重定向），可能要问重定向的几种状态码区别
通过重定向进行跳转，在整个重定向过程需携带用户打开的页面url信息
2.cookie绑定前端域
token直接放在cookie中其实不安全，一般做法是前端请求时放在头部。
两个token：access_token和refresh——token
3.为什么获取授权码之后还app后台还向sso要做一次验证
如果我在SSO没有登录，而是直接在浏览器中敲入重定向回调的地址，并带上伪造的用户信息，这时业务系统也会认为登录了